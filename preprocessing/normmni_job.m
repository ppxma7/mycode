% Define subject and deformation lists
mySubs = {'m001_H03.nii', 'm001_H07.nii', 'm001_H08.nii', 'm001_H09.nii', ...
    'm001_H11.nii', 'm001_H13.nii', 'm001_H14.nii', 'm001_H15.nii', ...
    'm001_H16.nii', 'm001_H17.nii', 'm001_H19.nii', 'm001_H23.nii', ...
    'm001_H24.nii', 'm001_H25.nii', 'm001_H27.nii', 'm001_H28.nii', ...
    'm001_H29.nii', 'm001_H30.nii', 'm001_P01.nii', 'm001_P02.nii', ...
    'm001_P04.nii', 'm001_P05.nii', 'm001_P06.nii', 'm001_P08.nii', ...
    'm001_P12.nii', 'm001_P13.nii', 'm001_P15.nii', 'm001_P16.nii', ...
    'm001_P17.nii', 'm001_P18.nii', 'm001_P19.nii', 'm001_P20.nii', ...
    'm001_P21.nii', 'm001_P22.nii', 'm001_P23.nii', 'm001_P24.nii', ...
    'm001_P26.nii', 'm001_P27.nii', 'm001_P28.nii', 'm001_P30.nii', ...
    'm001_P31.nii', 'm001_P32.nii', 'm001_P33.nii', 'm001_P35.nii', ...
    'm001_P37.nii', 'm001_P40.nii', 'm001_P41.nii', 'm001_P42.nii', ...
    'm001_P43.nii', 'm001_P44.nii', 'm001_P45.nii', 'm004_P01.nii', ...
    'mBL002.nii', 'mBL003.nii', 'mBL004.nii', 'mBL005.nii', 'mBL006.nii', ...
    'mBL007.nii', 'mBL008.nii', 'mBL010.nii', 'mBL011.nii', 'mBL012.nii', ...
    'mBL013.nii', 'mBL014.nii', 'mBL015.nii', 'mBL016.nii', 'mBL017.nii', ...
    'mBL018.nii'};

myDeformations = {'y_001_H03.nii', 'y_001_H07.nii', 'y_001_H08.nii', ...
    'y_001_H09.nii', 'y_001_H11.nii', 'y_001_H13.nii', 'y_001_H14.nii', ...
    'y_001_H15.nii', 'y_001_H16.nii', 'y_001_H17.nii', 'y_001_H19.nii', ...
    'y_001_H23.nii', 'y_001_H24.nii', 'y_001_H25.nii', 'y_001_H27.nii', ...
    'y_001_H28.nii', 'y_001_H29.nii', 'y_001_H30.nii', 'y_001_P01.nii', ...
    'y_001_P02.nii', 'y_001_P04.nii', 'y_001_P05.nii', 'y_001_P06.nii', ...
    'y_001_P08.nii', 'y_001_P12.nii', 'y_001_P13.nii', 'y_001_P15.nii', ...
    'y_001_P16.nii', 'y_001_P17.nii', 'y_001_P18.nii', 'y_001_P19.nii', ...
    'y_001_P20.nii', 'y_001_P21.nii', 'y_001_P22.nii', 'y_001_P23.nii', ...
    'y_001_P24.nii', 'y_001_P26.nii', 'y_001_P27.nii', 'y_001_P28.nii', ...
    'y_001_P30.nii', 'y_001_P31.nii', 'y_001_P32.nii', 'y_001_P33.nii', ...
    'y_001_P35.nii', 'y_001_P37.nii', 'y_001_P40.nii', 'y_001_P41.nii', ...
    'y_001_P42.nii', 'y_001_P43.nii', 'y_001_P44.nii', 'y_001_P45.nii', ...
    'y_004_P01.nii', 'y_BL002.nii', 'y_BL003.nii', 'y_BL004.nii', ...
    'y_BL005.nii', 'y_BL006.nii', 'y_BL007.nii', 'y_BL008.nii', ...
    'y_BL010.nii', 'y_BL011.nii', 'y_BL012.nii', 'y_BL013.nii', ...
    'y_BL014.nii', 'y_BL015.nii', 'y_BL016.nii', 'y_BL017.nii', ...
    'y_BL018.nii'};

thispath = '/Users/spmic/data/IBD_structs/';

% Iterate over all subjects
for ii = 1:length(mySubs)

    fprintf('\nRunning subject %s now...\n', mySubs{ii});
    
    % Initialize SPM batch

    matlabbatch{1}.spm.spatial.normalise.write.subj.def = {fullfile(thispath, myDeformations{ii})};
    matlabbatch{1}.spm.spatial.normalise.write.subj.resample = {fullfile(thispath, [mySubs{ii}, ',1'])};
    matlabbatch{1}.spm.spatial.normalise.write.woptions.bb = [-90 -126 -72; 90 90 108];
    matlabbatch{1}.spm.spatial.normalise.write.woptions.vox = [2 2 2];
    matlabbatch{1}.spm.spatial.normalise.write.woptions.interp = 4;
    matlabbatch{1}.spm.spatial.normalise.write.woptions.prefix = 'w';
    
    %keyboard


    % Run the batch
    spm_jobman('run', matlabbatch);
    
    % Clear batch for next iteration
    clear matlabbatch;
end
