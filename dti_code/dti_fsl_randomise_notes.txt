# Hi
- You need to prep by copying bvals: copybvalsbvecs.sh 
- You need to prep by hiding phase files (makeFolder_movephase.sh)
- then copy to hpc
- First run the dti data on the HPC using the brc pipeline: dti_run_chain.sh. This calls the BRC code dMRI_preproc.sh on the HPC.
- after can run dti_prep_moving.sh before TBSS 


https://web.mit.edu/fsl_v5.0.10/fsl/doc/wiki/TBSS(2f)UserGuide.html

# Before you do this, you need to prep and move things. The FA and MD maps are in dMRI/processed/data/data.dti/
# So you can run dti_prep_moving which moves things to a tbss dir with better names. Then you can run your TBSS analysis. Bear in mind, the MDs should be done separately, and renamed to FA as well.






# For the DTI data, you can run 
# Bear in mind, you will need to check files etc. and designs above
randomise -i all_FA_skeletonised.nii.gz -o tbss -m mean_FA_skeleton_mask -d design.mat -t design.con -n 10 --T2 -V
randomise -i all_FA_skeletonised -o tbss -m mean_FA_skeleton_mask -d design.mat -t design.con -n 500 --T2

# Note, for a pre post design, e.g. a repeated measures / paired test, the simplest thing to do is this:
#Â You take the differences and then run a one sample tttest between these. 

# make diffs
fslmaths SASHB1_16905_004_dti_FA -sub SASHB2_16905_005_dti_FA sub01_diff
fslmaths SASHB1_17880001_dti_FA -sub SASHB2_17880002_dti_FA sub02_diff
fslmaths SASHB1_156862_004_dti_FA -sub SASHB2_156862_005_dti_FA sub03_diff
fslmaths SASHB1_4_1_dti_FA -sub SASHB2_4_2_dti_FA sub04_diff
fslmaths SASHB1_5_1_dti_FA -sub SASHB2_5_2_dti_FA sub05_diff
fslmaths SASHB1_6_1_dti_FA -sub SASHB2_6_2_dti_FA sub06_diff
fslmaths SASHB1_7_1_dti_FA -sub SASHB2_7_2_dti_FA sub07_diff

# merge
fslmerge -t diffs_all sub01_diff sub02_diff sub03_diff sub04_diff sub05_diff sub06_diff sub07_diff

# run one-sample test with randomise using -1 (single-group)
randomise -i diffs_all -o paired_diff_oneSample -1 -T -n 5000

for filling the tracts for visualistiaon
tbss_fill tbss_tfce_corrp_tstat1 0.95 mean_FA tbss_fill



To run MD, you have to do this:
Create a new directory called L2 (or any other name) in your TBSS analysis directory (the one that contains the existing origdata, FA and stats directories from the FA analysis). Type: mkdir L2

Copy your L2 images into this new directory, making sure that they are named exactly the same as the original FA images were (look in origdata to check the original names - and keep them exactly the same, even if they include FA, which can be confusing; e.g. if there is an image origdata/subj005_FA.nii.gz then you need an image L2/subj005_FA.nii.gz and this file should contain the L2 data, even though it has FA in the name).
Now, making sure that you are in your top working TBSS directory (the one that now contains FA, stats and L2 subdirectories) and run the tbss_non_FA script, telling it that the alternate data is called L2. This will apply the original nonlinear registration to the L2 data, merge all subjects' warped L2 data into a 4D file stats/all_L2, project this onto the original mean FA skeleton (using the original FA data to find the projection vectors), resulting in the 4D projected data stats/all_L2_skeletonised. Run: tbss_non_FA L2

randomise -i all_MD_skeletonised.nii.gz -o tbss -m mean_FA_skeleton_mask -d design.mat -t design.con -n 500 --T2 -V

Also display using this fslmaths all_MD.nii.gz -Tmean mean_MD

